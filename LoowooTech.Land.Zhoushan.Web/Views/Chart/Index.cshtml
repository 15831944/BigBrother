@{
    Form form = ViewBag.Form;
    ViewBag.Title = "统计图 - " + form.Name;

    NodeValueParameter parameter = ViewBag.Parameter;
    List<NodeValue> nodeValues = ViewBag.NodeValues;
    List<NodeValue> childValues = ViewBag.ChildValues;
    List<NodeValue> quarterValues = ViewBag.QuarterValues;
    List<NodeValue> areaValues = ViewBag.AreaValues;

}
<h2 class="page-header">
    @(ViewBag.Title)
</h2>
<form id="form-filter" action="/chart/?formId=@(form.ID)" method="get" class="form-inline">
    <div class="input-group">
        <span class="input-group-addon">选择统计</span>
        <div class="input-group-btn">
            @Html.Action("NodeDropdown", "Chart", new { formId = form.ID, nodeId = parameter.NodeID })
            @Html.Partial("_YearDropdown", parameter.Year)
            @Html.Partial("_QuarterDropdown", parameter.Quarter)
            @Html.Action("Dropdown", "Area", new { AreaID = parameter.AreaID })
            @Html.Partial("_RateTypeDropdown", parameter.RateType)
            <button type="submit" class="btn btn-primary"><i class="glyphicon glyphicon-filter"></i> 过滤</button>
            <a class="btn btn-default" href="#/form/">
                <i class="fa fa-chevron-left"></i> 返回
            </a>
        </div>
    </div>
</form>
<div class="col-lg-3">
    <canvas id="selectedChart"></canvas>
</div>

<script>

    $(function () {

        showChildValueChart();

        function getColors(len){
            var colors = ["#FF6384",
            "#4BC0C0",
            "#FFCE56",
            "#E7E9ED",
            "#36A2EB"];

            return colors.slice(0,len);
        }

        function showChildValueChart(){
            var labels = @Html.Raw(childValues.Select(e => e.Node.Name).ToJson()) || [];
            var data = @Html.Raw(childValues.Select(e=>e.Value).ToJson()) || [];
            var ctx = document.getElementById("selectedChart");
            var myChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets:[{
                        data:data,
                        backgroundColor:getColors(data.length)
                    }]
                }
            });
        }



        $("#form-filter").submit(function () {
            var data = $(this).serialize();
            var action = $(this).attr("action");
            if (action.indexOf('?') == -1) {
                action = action + "?";
            }
            action = action + "&" + data;
            $.loadMain(action);
            return false;
        });
    });
</script>
