@{
    Form form = ViewBag.Form;
    Node node = ViewBag.Node;
    ViewBag.Title = "统计图 - " + form.Name;

    int? year = ViewBag.Year;
    int? areaId = ViewBag.AreaID;
    int? typeId = ViewBag.TypeID;
    NodeValueTime? timeId = ViewBag.TimeID;
}
<h2 class="page-header">
    @(ViewBag.Title)
</h2>
<form id="form-filter" action="/chat/index?formId=@(form.ID)" method="get" class="form-inline">
    <div class="input-group">
        <div class="input-group-btn">
            @Html.Action("NodeDropdown", "Chat", new { formId = form.ID, nodeId = node == null ? 0 : node.ID })
            @Html.Partial("_YearDropdown", year)
            @Html.Partial("_SeasonDropdown", timeId)
            @Html.Action("Dropdown", "Area", new { AreaID = areaId })
            <button type="submit" class="btn btn-primary"><i class="glyphicon glyphicon-filter"></i> 过滤</button>
            <a class="btn btn-default" href="#/form/">
                <i class="fa fa-chevron-left"></i> 返回
            </a>
        </div>
    </div>
</form>
<script>
    $(function () {
        $("#form-filter").submit(function () {
            var data = $(this).serialize();
            var action = $(this).attr("action");
            if (action.indexOf('?') == -1) {
                action = action + "?";
            }
            $.loadMain(action);
        });

        if ("@(node.ID)" == "0") {
            $("#form-filter").submit();
        }
    });
</script>
